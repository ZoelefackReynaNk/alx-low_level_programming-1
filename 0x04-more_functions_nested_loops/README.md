more functons and nested loops